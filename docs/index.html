<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>입시정보 검색</title>
  <style>
    body {
      font-family: 'Noto Sans KR', sans-serif;
      margin: 0;
      padding: 1rem;
      background: #f4f4f4;
    }
    .filter-section {
      margin-bottom: 1rem;
    }
    .filter-title {
      font-weight: bold;
      margin-bottom: 0.5rem;
    }
    .button-group {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
    }
    .filter-button {
      padding: 0.5rem 1rem;
      border-radius: 20px;
      background: #e0e0e0;
      cursor: pointer;
    }
    .filter-button.selected {
      background: #4CAF50;
      color: white;
    }
    #popup {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0, 0, 0, 0.6);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    #popupContent {
      background: white;
      padding: 2rem;
      max-width: 500px;
      border-radius: 10px;
      white-space: pre-line;
    }
    button {
      margin-top: 1rem;
      padding: 0.5rem 1.2rem;
      border: none;
      background: #2196F3;
      color: white;
      border-radius: 5px;
      cursor: pointer;
    }
    .result {
      margin-top: 1rem;
      background: white;
      padding: 1rem;
      border-radius: 10px;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
    }
    .highlight-blue { background-color: #bbdefb; }
    .highlight-green { background-color: #c8e6c9; }
    .highlight-yellow { background-color: #fff9c4; }
  </style>
</head>
<body>

<div id="popup">
  <div id="popupContent">
    해당 자료는 대학에서 발표한 입시 결과를 수집한 자료로 제작되었습니다. 모든 대학이나 학과가 표시되지는 않을 수 있습니다. 대략적인 검색을 제공하나 정확한 결과는 각 대학의 입학처를 참고하시기 바랍니다. 모든 결정 전에는 학교 상담을 꼭 받으시기 바랍니다.
    
    [내 성적]란에 적힌 성적과 대학 자체 성적을 단순 숫자로만 비교하여 색으로 시각적 표현을 줬을 뿐, 정확한 입시 결과를 제공하지 않습니다. 
    파란색 - [성적1]에 적힌 숫자보다 작을 때
    초록색 - [성적1]과 [성적2] 사이에 위치할 때
    노란색 - [성적2]와 [성적2 + 0.5] 사이에 위치할 때
    * 원하는 대학의 정확한 성적은 담임 상담 또는 대학 입학처 참고 *
    * 결정에 대한 모든 책임은 본인에게 있습니다. 이에 동의하는 사용자만 이용 바랍니다. *
    <br>
    <button onclick="document.getElementById('popup').style.display='none'">동의하고 이용하기</button>
  </div>
</div>

<h2>입시정보 검색</h2>

<input type="text" id="searchInput" placeholder="학과명 또는 대학명 입력" style="width:100%; margin-bottom:1rem; padding:8px;"/>

<div class="filter-section">
  <div class="filter-title">연도 선택</div>
  <div id="yearFilter" class="button-group"></div>
</div>

<div class="filter-section">
  <div class="filter-title">지역 선택</div>
  <div id="regionFilter" class="button-group"></div>
</div>

<div id="results"></div>

<script>
  let jsonData = [];
  const selectedYears = new Set(['전체']);
  const selectedRegions = new Set();

  function createFilterButtons(data) {
    // 연도
    const yearSet = new Set(data.map(d => d['연도']).filter(y => y));
    const yearContainer = document.getElementById('yearFilter');
    const allBtn = createButton('전체', 'year', true);
    yearContainer.appendChild(allBtn);
    yearSet.forEach(year => {
      const btn = createButton(year, 'year');
      yearContainer.appendChild(btn);
    });

    // 지역
    const regionSet = new Set(data.map(d => d['지역']).filter(r => r));
    const regionContainer = document.getElementById('regionFilter');
    regionSet.forEach(region => {
      const btn = createButton(region, 'region');
      regionContainer.appendChild(btn);
    });
  }

  function createButton(label, type, selected = false) {
    const btn = document.createElement('span');
    btn.className = 'filter-button';
    btn.textContent = label;
    if (selected) {
      btn.classList.add('selected');
    }
    btn.onclick = () => {
      if (type === 'year') {
        if (label === '전체') {
          selectedYears.clear();
          selectedYears.add('전체');
          resetButtons('year');
        } else {
          selectedYears.delete('전체');
          toggleSet(selectedYears, label);
        }
        toggleClass(btn);
      } else {
        toggleSet(selectedRegions, label);
        toggleClass(btn);
      }
      renderResults(document.getElementById('searchInput').value);
    };
    btn.dataset.type = type;
    return btn;
  }

  function resetButtons(type) {
    document.querySelectorAll(`[data-type="${type}"]`).forEach(el => {
      el.classList.remove('selected');
      if (el.textContent === '전체') el.classList.add('selected');
    });
  }

  function toggleClass(el) {
    el.classList.toggle('selected');
  }

  function toggleSet(set, value) {
    set.has(value) ? set.delete(value) : set.add(value);
  }

  function fetchData() {
    fetch("data/major_data.json")
      .then(res => res.json())
      .then(data => {
        jsonData = data;
        createFilterButtons(data);
      });
  }

  function renderResults(query) {
    const container = document.getElementById('results');
    container.innerHTML = '';
    const filtered = jsonData.filter(item => {
      const matchesQuery = (item['대학명']?.includes(query) || item['학과명']?.includes(query));
      const matchesYear = selectedYears.has('전체') || selectedYears.has(item['연도']);
      const matchesRegion = selectedRegions.size === 0 || selectedRegions.has(item['지역']);
      return matchesQuery && matchesYear && matchesRegion;
    });

    filtered.forEach(item => {
      const div = document.createElement('div');
      div.className = 'result';
      const val1 = parseFloat(item['성적1']);
      const val2 = parseFloat(item['성적2']);
      const myScore = parseFloat(item['내 성적']);
      if (!isNaN(val1) && !isNaN(val2) && !isNaN(myScore)) {
        if (myScore < val1) div.classList.add('highlight-blue');
        else if (myScore <= val2) div.classList.add('highlight-green');
        else if (myScore <= val2 + 0.5) div.classList.add('highlight-yellow');
      }

      let html = '';
      Object.keys(item).forEach(key => {
        html += `<b>${key}</b>: ${item[key] ? item[key] : '미제공'}<br>`;
      });
      div.innerHTML = html;
      container.appendChild(div);
    });
  }

  document.getElementById('searchInput').addEventListener('input', e => {
    renderResults(e.target.value);
  });

  fetchData();
</script>

</body>
</html>
