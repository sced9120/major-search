<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>입시정보 검색</title>
  <style>
    body {
      font-family: 'Noto Sans KR', sans-serif;
      margin: 0;
      padding: 1rem;
      background: #f4f4f4;
    }
    .region-button {
      display: inline-block;
      padding: 0.5rem 1rem;
      margin: 0.2rem;
      border-radius: 20px;
      background: #e0e0e0;
      cursor: pointer;
    }
    .region-button.selected {
      background: #4CAF50;
      color: white;
    }
    #popup {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0, 0, 0, 0.6);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    #popupContent {
      background: white;
      padding: 2rem;
      max-width: 500px;
      border-radius: 10px;
      text-align: left;
      white-space: pre-line;
    }
    button {
      margin-top: 1rem;
      padding: 0.5rem 1.2rem;
      border: none;
      background: #2196F3;
      color: white;
      border-radius: 5px;
      cursor: pointer;
    }
    .result {
      margin-top: 1rem;
      background: white;
      padding: 1rem;
      border-radius: 10px;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
    }
    .highlight-blue { background-color: #bbdefb; }
    .highlight-green { background-color: #c8e6c9; }
    .highlight-yellow { background-color: #fff9c4; }
  </style>
</head>
<body>

<div id="popup">
  <div id="popupContent">
    해당 자료는 대학에서 발표한 입시 결과를 수집한 자료로 제작되었습니다. 모든 대학이나 학과가 표시되지는 않을 수 있습니다. 대략적인 검색을 제공하나 정확한 결과는 각 대학의 입학처를 참고하시기 바랍니다. 모든 결정 전에는 학교 상담을 꼭 받으시기 바랍니다.
    
    [내 성적]란에 적힌 성적과 대학 자체 성적을 단순 숫자로만 비교하여 색으로 시각적 표현을 줬을 뿐, 정확한 입시 결과를 제공하지 않습니다. 
    파란색 - [성적1]에 적힌 숫자보다 작을 때
    초록색 - [성적1]과 [성적2] 사이에 위치할 때
    노란색 - [성적2]와 [성적2 + 0.5] 사이에 위치할 때
    * 원하는 대학의 정확한 성적은 담임 상담 또는 대학 입학처 참고 *
    * 결정에 대한 모든 책임은 본인에게 있습니다. 이에 동의하는 사용자만 이용 바랍니다. *
    <br>
    <button onclick="document.getElementById('popup').style.display='none'">동의하고 이용하기</button>
  </div>
</div>

<h2>입시정보 검색</h2>

<div>
  <label>지역 설정:</label>
  <div id="regionFilter"></div>
</div>

<input type="text" id="searchInput" placeholder="학과 또는 대학명 검색" style="width:100%; margin-top:10px; padding:8px;"/>

<div id="results"></div>

<script>
  let jsonData = [];
  const selectedRegions = new Set();

  // 지역 필터 생성
  function createRegionButtons(data) {
    const regionSet = new Set(data.map(d => d['지역']).filter(r => r));
    const container = document.getElementById('regionFilter');
    regionSet.forEach(region => {
      const btn = document.createElement('span');
      btn.className = 'region-button';
      btn.textContent = region;
      btn.onclick = () => {
        btn.classList.toggle('selected');
        selectedRegions.has(region) ? selectedRegions.delete(region) : selectedRegions.add(region);
        renderResults(document.getElementById('searchInput').value);
      };
      container.appendChild(btn);
    });
  }

  function fetchData() {
    fetch('https://script.google.com/macros/s/AKfycbXXXXXXX/exec')  // <-- JSON API 주소로 교체
      .then(res => res.json())
      .then(data => {
        jsonData = data;
        createRegionButtons(data);
      });
  }

  function renderResults(query) {
    const resultContainer = document.getElementById('results');
    resultContainer.innerHTML = '';
    const filtered = jsonData.filter(item => {
      const inRegion = selectedRegions.size === 0 || selectedRegions.has(item['지역']);
      const inQuery = item['대학명']?.includes(query) || item['학과명']?.includes(query);
      return inRegion && inQuery;
    });

    filtered.forEach(item => {
      const div = document.createElement('div');
      div.className = 'result';
      const val1 = parseFloat(item['성적1']);
      const val2 = parseFloat(item['성적2']);
      const myScore = parseFloat(item['내 성적']);
      if (!isNaN(val1) && !isNaN(val2) && !isNaN(myScore)) {
        if (myScore < val1) div.classList.add('highlight-blue');
        else if (myScore <= val2) div.classList.add('highlight-green');
        else if (myScore <= val2 + 0.5) div.classList.add('highlight-yellow');
      }

      let html = '';
      Object.keys(item).forEach(key => {
        html += `<b>${key}</b>: ${item[key] ? item[key] : '미제공'}<br>`;
      });
      div.innerHTML = html;
      resultContainer.appendChild(div);
    });
  }

  document.getElementById('searchInput').addEventListener('input', e => {
    renderResults(e.target.value);
  });

  fetchData();
</script>

</body>
</html>
